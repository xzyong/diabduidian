<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>地址管理</title>
    <link rel="stylesheet" href="__PUBLIC__/index/css/weui.min.css">
    <link rel="stylesheet" href="__PUBLIC__/index/css/jquery-weui.min.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/index/css/font_icon/iconfont.css">
    <link rel="stylesheet" href="__PUBLIC__/index/css/my-sytle.css">
    <style>
        .weui-picker-modal-visible {
            height:18rem;
        }
        .weui-picker-modal .picker-modal-inner {
            height:15.8rem;
        }
    </style>
</head>

<body style="background-color: #f9f9f9;">
<div class="contents add_manage">


    {volist name="list" id="v" empty="$empty"}
    <div class="wrapper">
        <div class="center">
            <div class="center_top"><o>{$v.name}</o><span>{$v.telephone}</span></div>
            <div class="center_bottom"><sheng>{$v.province_id}</sheng><shi>{$v.city_id}</shi><qu>{$v.country_id}</qu> <span class="addre">{$v.address}</span></div>
        </div>
        <div class="right">
            <a href="javascript:;"  data-id="{$v.address_id}" class="open-popup edit" data-target="#hal">
                <i  class="icon iconfont icon-bianji"></i>
            </a>
        </div>
    </div>
    {/volist}

    <div class="tianjia_buttom"><a href="javascript:;" id="add" class="weui-btn weui-btn_primary open-popup" data-target="#half" >
        <i class="icon iconfont icon-add" ></i>添加新地址
    </a></div>



    <!--底部弹出层-->
    <form>
        <div id="half" class='weui-popup__container popup-bottom'>
            <div class="weui-popup__overlay"></div>
            <div class="weui-popup__modal add_zhezao">
                <div class="top-inner">
                    <a href="javascript:;" class="picker-button close-popup">关闭</a>
                    <h1 class="title">收货地址</h1>
                </div>

                <div class="modal-content">
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">收件人：</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="text" id="name" placeholder="请输入收件人姓名" value="">
                        </div>
                    </div>

                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">手机号码：</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="telephone" pattern="[0-9]*" placeholder="请输入手机号码" value="">
                        </div>
                    </div>

                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label for="name" class="weui-label">地区信息：</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" id="start" type="text" value="广东省 深圳市 宝安区" id="area" readonly="">
                        </div>
                    </div>

                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">详细地址：</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="text" id="address" placeholder="请输入详细地址" value="">
                        </div>
                    </div>

                    <div class="tianjia_buttom" style="border-top: 1px solid #e3e3e3; padding-bottom: 5px;">
                        <input type="button" id="ad_address"  class="weui-btn weui-btn_primary close-popup" value="确定" />


                    </div>

                </div>

            </div>

        </div>
    </form>
    <!--底部弹出层-->
    <form>
        <div id="hal" class='weui-popup__container popup-bottom'>
            <div class="weui-popup__overlay"></div>
            <div class="weui-popup__modal add_zhezao">
                <div class="top-inner">
                    <a href="javascript:;" class="picker-button close-popup">关闭</a>
                    <h1 class="title">收货地址</h1>
                </div>

                <div class="modal-content">
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">收件人：</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="text" id="up-name" placeholder="请输入收件人姓名" value="">
                        </div>
                    </div>

                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">手机号码：</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="up-telephone" pattern="[0-9]*" placeholder="请输入手机号码" value="">
                        </div>
                    </div>

                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label for="name" class="weui-label">地区信息：</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input update" id="update" type="text" value="广东省 深圳市 宝安区" name="area" readonly="">
                        </div>
                    </div>

                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">详细地址：</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="text" id="up-address" placeholder="请输入详细地址" value="">
                        </div>
                    </div>



                </div>
                <div class="tianjia_buttom" style="border-top: 1px solid #e3e3e3; padding-bottom: 5px;">
                    <input type="button" id="edit_address"  class="weui-btn weui-btn_primary" value="确定" />


                </div>

            </div>


        </div>
    </form>
    <script src="__PUBLIC__/index/js/jquery-2.1.4.js"></script>
    <script src="__PUBLIC__/index/js/jquery-weui.min.js"></script>
    <script src="__PUBLIC__/index/js/swiper.min.js"></script>
    <script src="__PUBLIC__/index/js/city-picker.min.js"></script>
</div>

</body>

</html>
<script type="text/javascript">

    $("#update").cityPicker({
        title: "选择地区",
        onChange: function (picker, values, displayValues) {
            console.log(values, displayValues);
        }
    });
    $('#add').click(function(){
        var length = $('.wrapper').length;
        if (length>=6) {
            $('#add').attr('data-target','1');
            $.alert('最多只能添加6个地址！');
        }
    });
    //新增地址
    $('#ad_address').click(function(){
        var telephone = $('#telephone').val();
        var area = $('#start').val();
        var mobile_phone1 = /^1[3|4|5|7|8]\d{9}$/;
        var address = $('#address').val();
        var name = $('#name').val();

        if (name == "") {
            $.alert("收件人不能为空");
            return false;
        }
        if (!mobile_phone1.test(telephone)) {
            $.alert("手机号不正确");
            return false;
        }
        if (address == "") {
            $.alert("地址不能为空");
            return false;
        }
        $.post(
                "{:url('Account/add_address')}",
                {telephone:telephone,area:area,address:address,name:name},
                function(d){
                    if(d.success){
                        $.alert(d.success);
                        window.location.reload();
                    }else{
                        $.alert(d.error);
                    }
                }
        )
    });


    $('.edit').click(function(){
        var name= $(this).parent().prev('.center').children('.center_top').find('o').html();
        var telephone= $(this).parent().prev('.center').children('.center_top').find('span').html();
        var sheng= $(this).parent().prev('.center').children('.center_bottom').find('sheng').html();
        var shi= $(this).parent().prev('.center').children('.center_bottom').find('shi').html();
        var qu= $(this).parent().prev('.center').children('.center_bottom').find('qu').html();
        var area = sheng+' '+shi+' '+qu;
        var address= $(this).parent().prev('.center').children('.center_bottom').find('.addre').html();
        var id=$(this).attr('data-id');

        $('#up-name').attr('data-id',id);
        $('#up-name').val(name);
        $('#up-telephone').val(telephone);
        $('#update').val(area);
        $('#up-address').val(address);


    });
    //修改地址
    $('#edit_address').click(function(){

        var telephone = $('#up-telephone').val();
        var area = $('#update').val();
        var mobile_phone1 = /^1[3|4|5|7|8]\d{9}$/;
        var address = $('#up-address').val();
        var name = $('#up-name').val();
        var id = $('#up-name').attr('data-id');
//        alert(name);
        if (name == "") {
            $.alert("收件人不能为空");
            return false;
        }
        if (!mobile_phone1.test(telephone)) {
            $.alert("手机号不正确");
            return false;
        }
        if (address == "") {
            $.alert("地址不能为空");
            return false;
        }
        $.post(
                "{:url('Account/edit_address')}",
                {telephone:telephone,area:area,address:address,name:name,address_id:id},
                function(d){
                    if(d.success){
                        $.alert(d.success);
                        window.location.reload();
                    }else{
                        $.alert(d.error);
                    }
                }
        )
    });


</script>